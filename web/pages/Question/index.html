<!DOCTYPE html>
<html lang="en">
<head>
    <title>Question</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <script src="/assets/js/jquery.min.js"></script>
</head>

<body>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <!------ Include the above in your HEAD tag ---------->
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="collapsed navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-6" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="#" class="navbar-brand">Brand</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="/">Home</a>
                    </li>
                    <li>
                        <a href="/template">Template</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class=" row pull-right">
            <a href="/question/all">See All Questions</a>
        </div>
        <div class="form-group">
            <label>Template</label>
            <div id="select"></div>
        </div>
        <div class="row">
            <div class="control-group" id="fields">
                <div class="controls">
                    <form role="form" autocomplete="off">
                        <div class="form-group">
                            <input type="button" class="btn btn-default" value="Add Q&A" onclick="addToList()">
                            <input type="button" class="btn btn-info" value="Save All" onclick="saveQnA()">
                        </div>
                            <input class="form-control" name="question" id="question" type="text" placeholder="Question" />
                            <div class="entry input-group">
                                <input class="form-control" name="answer" type="text" placeholder="Answer" />
                                <span class="input-group-btn">
                                    <button class="btn btn-success btn-add" type="button">
                                        <span class="glyphicon glyphicon-plus"></span>
                                    </button>
                                </span>
                            </div>
                    </form>
                    <br>
                    <small>Press <span class="glyphicon glyphicon-plus gs"></span> to add another answer.</small>
                </div>
                <div>
                    <ul id="list">
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script>
        var list = [];
        $(document).ready(function () {
            getAllTemplates();
        })
        $(function () {

            $(document).on('click', '.btn-add', function (e) {
                e.preventDefault();

                var controlForm = $('.controls form:first'),
                    currentEntry = $(this).parents('.entry:first'),
                    newEntry = $(currentEntry.clone()).appendTo(controlForm);

                newEntry.find('input').val('');
                controlForm.find('.entry:not(:last) .btn-add')
                    .removeClass('btn-add').addClass('btn-remove')
                    .removeClass('btn-success').addClass('btn-danger')
                    .html('<span class="glyphicon glyphicon-minus"></span>');
            }).on('click', '.btn-remove', function (e) {
                $(this).parents('.entry:first').remove();

                e.preventDefault();
                return false;
            });
        });
        function removeAll() {
            // $(".entry").each(e => {
            //     debugger;
            //     $(e).remove();
            // })
            $('.entry').filter(function(i) {
            return (i >= 1);
            }).remove();
        }
        function addAnswer() {
            var el = '<input type="text" value="" placeholder="Answer" name="answer" /><br />';
            $("#answers").append(el);
            //document.getElementById("answers").appendChild(...document.getElementsByName('answer').item(0));
        }
        function saveQnA() {
            debugger;
            var requestData = {};
            requestData["question"] = document.getElementById("question").value;
            var inputs = document.getElementsByName('answer');
            const answers = [].map.call(inputs, function (input) { return input.value; });
            requestData["answers"] = answers;
            requestData["temp"] = $("#tempSel").val();
            $.ajax({
                method: "POST",
                url: "/api/question/postqna",
                contentType: "application/json",
                data: JSON.stringify({ data: list }),
                success: (data) => {
                    alert("Ok");
                }
            })
        }
        function addToList() {

            // let data = $($("form")[0]).serializeArray();
            let data = {};
            data["question"] = document.getElementById("question").value;
            var inputs = document.getElementsByName('answer');
            const answers = [].map.call(inputs, function (input) { return input.value; });
            data["answers"] = answers;
            data["temp"] = $("#tempSel").val();
            list.push(data);
            $('form')[0].reset();
            debugger;
            removeAll();
            var li = "<li>\
<span>Q:"+ data["question"] + "</span>\
<ul>";
            data["answers"].forEach((e, i) => {
                li += "<li> A:" + e + "</li>";
            });
            li += "</li></ul>";
            $("#list").append(li);
        }
        function getAllTemplates() {
            $.ajax({
                method: "GET",
                url: "/api/template/all",
                contentType: "application/json",
                success: (data) => {
                    data = data.data;
                    var html = "<select id='tempSel' class='form-control' style='width:160px;'>";
                    data.forEach((el, ndx, arr) => {
                        html += "<option value=" + el.id + ">" + el.name + "</option>";
                    });
                    html += "</select>";
                    $("#select").html(html);
                    html = "";
                },
                error: () => {
                    alert("Error");
                }
            });
        }

    </script>
</body>

</html>